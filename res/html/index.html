<!doctype html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Hello World!</title>
    <link rel="stylesheet" href="../css/index.css" type="text/css" />
  </head>
  <body>
    <h1>Hello World!</h1>
    We are using node <script>document.write(process.versions.node)</script>,
    Chrome <script>document.write(process.versions.chrome)</script>,
    and Electron <script>document.write(process.versions.electron)</script>.

    <ul>
      <li><div name="dropBox" id="dropBox"/></li>
      <li><div name="editBox" id="editBox"/></li>
    </ul>

    <script>
    // 拖拽的目标对象 document 监听drop 并防止浏览器打开客户端的图片
    document.ondragover = function (e) {
      e.preventDefault(); // 只有在ondragover中阻止默认行为才能触发 ondrop 而不是 ondragleave
    };
    document.ondrop = function (e) {
      e.preventDefault(); // 阻止 document.ondrop的默认行为 *** 在新窗口中打开拖进的图片
    };
    dropBox.ondragover = function (e) {
      e.stopPropagation();  
      e.preventDefault();
    };
    dropBox.ondragenter = function (e) {
      dropBox.style.borderColor = 'gray';  
      dropBox.style.backgroundColor = 'white';  
      e.stopPropagation();  
      e.preventDefault();
    };
    dropBox.ondragleave = function (e) {
      dropBox.style.borderColor = 'silver';  
      dropBox.style.backgroundColor = 'transparent';  
      e.stopPropagation();  
      e.preventDefault(); 
    };
    dropBox.ondrop = function (e) {
      dropBox.style.borderColor = 'silver';  
      dropBox.style.backgroundColor = 'transparent';  
      e.stopPropagation();  
      e.preventDefault();  
      handleFiles(e.dataTransfer.files);
    };

    function handleFiles(files) {  
      for (var i = 0; i < files.length; i++) {  
        var file = files[i];  
        reader(file);
      }  
    }  
     
    function reader(file) {
        if (file.type.match(/image*/)) {  
          var img = document.createElement("img");  
          img.classList.add("obj");  
          img.file = file;  
          dropBox.appendChild(img);  
          
          var reader = new FileReader();  
          reader.onload = function () {
            console.log(reader.result);
            img.src = reader.result;
          }
          reader.readAsDataURL(file);  
        } else {
          // <input id="File1" type="file" value="" name ="file"/ >
          var input = document.createElement("input");  
          input.classList.add("obj");  
          editBox.appendChild(input);  

          var reader = new FileReader();
          reader.onload = function () {
            // console.log(reader.result);
            var jsonStr = reader.result;
            input.value = jsonStr;

            isJson = function(obj){
              var isjson = typeof(obj) == "object" && Object.prototype.toString.call(obj).toLowerCase() == "[object object]" && !obj.length;
              isjson = !isjson;
              console.log(isjson);
              return isjson;
            }
            if (!isJson(jsonStr)) return;

            var jsonObj = eval('(' + jsonStr + ')');
            console.log(jsonObj);
            // for (var j = 0; j < jsonObj.length; j++) {
            //   alert(jsonObj[j].id);
            //   alert(jsonObj[j].name);
            // }
            for (var o in jsonObj) {  
              console.log(o);
              console.log(jsonObj[o]);
              console.log(typeof(jsonObj[o]));
              if (typeof(jsonObj[o]) == "object") {
                for (var o1 in jsonObj[o]) {  
                  console.log(o1);
                  console.log(jsonObj[o][o1]);
                }
              }
            }
          }
          reader.readAsText(file);

          // var minSize = 10;
          // var maxSize = 600;
          // input.style.width = minSize + "px";
          // input.style.height = minSize + "px";
          // console.log(input.scrollWidth);
          // console.log(input.scrollHeight);
          // input.style.width = ((input.scrollWidth < maxSize)?input.scrollWidth:maxSize) + "px";
          // input.style.height = ((input.scrollHeight < maxSize)?input.scrollHeight:maxSize) + "px";
        }
    }
    </script>
  </body>
</html>